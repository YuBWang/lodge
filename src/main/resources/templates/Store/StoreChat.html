<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>后台管理</title>
    <!--    页面二-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>商家列表</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="../../static/jiemian2/vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="../../static/jiemian2/vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="../../static/jiemian2/css/fontastic.css">
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <!-- jQuery Circle-->
    <link rel="stylesheet" href="../../static/jiemian2/css/grasp_mobile_progress_circle-1.0.0.min.css">
    <!-- Custom Scrollbar-->
    <link rel="stylesheet" href="../../static/jiemian2/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="../../static/jiemian2/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="../../static/jiemian2/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="../../static/jiemian2/img/favicon.ico">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->

    <!--    页面一-->
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <link href="../../static/jiemian1/css/SYSFrame.css" rel="stylesheet" type="text/css" />
    <link href="../../static/jiemian1/font/iconfont.css" rel="stylesheet" type="text/css" />
    <link href="../../static/jiemian1/css/module.css" rel="stylesheet" type="text/css" />
    <link href="../../static/jiemian1/css/pages.css" rel="stylesheet" type="text/css" />
    <title>商品管理</title>
    <script src="../../static/jiemian1/js/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="../../static/jiemian1/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="../../static/jiemian1/js/HUpages.js" type="text/javascript"></script>

    <script src="../../static/jiemian1/js/template.js" type="text/javascript"></script>
    <!--[if lt IE 9]>
    <script src="../../static/jiemian1/js/html5shiv.js" type="text/javascript"></script>
    <script src="../../static/jiemian1/js/css3-mediaqueries.js"  type="text/javascript"></script>
    <![endif]-->
    <!--    页面三-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
<!--    <link href="../../static/jiemian3/assets/css/bootstrap.min.css" rel="stylesheet" />-->
    <link rel="stylesheet" href="../../static/jiemian3/css/style.css"/>
    <link href="../../static/jiemian3/assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="../../static/jiemian3/assets/css/ace.min.css" />
    <link rel="stylesheet" href="../../static/jiemian3/font/css/font-awesome.min.css" />
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="../../static/jiemian3/assets/css/ace-ie.min.css" />
    <![endif]-->
    <script src="../../static/jiemian3/js/jquery-1.9.1.min.js"></script>
    <script src="../../static/jiemian3/assets/js/bootstrap.min.js"></script>
    <script src="../../static/jiemian3/assets/js/typeahead-bs2.min.js"></script>
    <script src="../../static/jiemian3/assets/js/jquery.dataTables.min.js"></script>
    <script src="../../static/jiemian3/assets/js/jquery.dataTables.bootstrap.js"></script>
    <script src="../../static/jiemian3/assets/layer/layer.js" type="text/javascript" ></script>
    <script src="../../static/jiemian3/assets/laydate/laydate.js" type="text/javascript"></script>
    <script src="../../static/jiemian3/js/lrtk.js" type="text/javascript" ></script>

    <link rel="stylesheet" th:href="@{/webjars/mdui/dist/css/mdui.css}">
    <script src="../static/login/js/jquery.min.js"></script>
    <script th:src="@{/webjars/mdui/dist/js/mdui.js}"></script>
    <style type="text/css">
        #div{
            width: 100%;
            height: 500px;
            overflow-x: hidden;
            overflow-y: scroll;

        }
        #div::-webkit-scrollbar{
            display: none;
        }

    </style>


</head>
<body id="situation" class="mdui-theme-primary-indigo mdui-theme-accent-pink">
<!-- Side Navbar -->
<nav class="side-navbar">
    <div class="side-navbar-wrapper">
        <!-- Sidebar Header    -->
        <div class="sidenav-header d-flex align-items-center justify-content-center">
            <!-- User Info-->

            <!-- Small Brand information, appears on minimized sidebar-->
            <div class="sidenav-header-logo"><a href="../index.html" class="brand-small text-center"> <strong>B</strong><strong class="text-primary">D</strong></a></div>
        </div>
        <!-- Sidebar Navigation Menus-->
        <div class="main-menu">
            <h5 class="sidenav-heading">Main</h5>
            <ul id="side-main-menu" class="side-menu list-unstyled">
                <li><a href="StoreHome"> <i class="icon-home"></i>Home</a></li>
                <li><a href="#exampledropdownDropdown" aria-expanded="false" data-toggle="collapse"> <i class="icon-interface-windows"></i>店铺管理 </a>
                    <ul id="exampledropdownDropdown" class="collapse list-unstyled ">
                        <li><a href="ordmanager">订单列表</a></li>
                        <li><a href="ProdectManager">商品管理</a></li>
                        <li><a href="addEat">餐饮展示</a> </li>
                        <li><a href="toSignhtml">每日签到</a> </li>
                    </ul>
                </li>
                <li> <a th:href="@{messageList}"> <i class="icon-mail"></i>消息
                    <div class="badge badge-warning">[[${count}]] New</div></a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="page">
    <div>
        <div class="mdui-container container_text">

            <div class="mdui-row">
                <div class="mdui-col-xs-12 mdui-col-sm-6">
                    <div class="mdui-col-xs-12 mdui-col-sm-10">
                        <div class="mdui-textfield-floating-label" style="margin-top:15px">
                            <i class="mdui-icon material-icons"></i>
                            <input type="text" th:value="${inuse}" hidden="hidden"  id="username" />
                            <input type="text" id="touser" hidden="hidden" th:value="${outuse}">
                        </div>
                    </div>
                    <div class="mdui-col-xs-12 mdui-col-sm-10">
                        <div class="mdui-textfield mdui-textfield-floating-label">
                            <i class="mdui-icon material-icons">textsms</i>
                            <label class="mdui-textfield-label">发送内容</label>
                            <input class="mdui-textfield-input" id="msg"/>
                        </div>
                        <div class="mdui-container" style="padding:20px 35px">
                            <button class="mdui-btn mdui-color-theme-accent mdui-ripple"
                                    onclick="send()">发送 (enter)
                            </button>
                            <button class="mdui-btn mdui-color-theme mdui-ripple"
                                    onclick="clearMsg()">清屏
                            </button>

                        </div>
                    </div>
                    <div style="margin-top: 50px; color: #00be67"> <p ><h6>若无法发送消息，请刷新界面</h6></p></div>
                </div>

                <div class="mdui-col-xs-6 mdui-col-sm-5" style="padding:10px 0">
                    <div class="mdui-chip">
                    <span class="mdui-chip-icon mdui-color-blue">
                        <i class="mdui-icon material-icons">&#xe420;</i></span>
                        <span class="mdui-chip-title">聊天内容</span>
                    </div>

                    <div class="mdui-chip">
                    <span class="mdui-chip-icon mdui-color-blue">
                        <i class="mdui-icon material-icons">face</i></span>
                        <span class="mdui-chip-title"></span>
                        <span class="mdui-chip-title chat-num" >[[${storeName}]]</span>
                    </div>
                    <div class="message-container" id="div" th:if="${not#lists.isEmpty(list)}" >
                        <div th:each="li:${list}">
                            <div class="mdui-card" style="margin: 3px 0;" >
                                <div class="mdui-card-content message-content"><h6>[[${li.getTimes()}]]</h6>[[${li.getSenderid()}]]: [[${li.getMessages()}]]  </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>



</div>
<!-- JavaScript files-->
<script src="../../static/jiemian2/vendor/jquery/jquery.min.js"></script>
<script src="../../static/jiemian2/vendor/popper.js/umd/popper.min.js"> </script>
<script src="../../static/jiemian2/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../../static/jiemian2/js/grasp_mobile_progress_circle-1.0.0.min.js"></script>
<script src="../../static/jiemian2/vendor/jquery.cookie/jquery.cookie.js"> </script>
<script src="../../static/jiemian2/vendor/chart.js/Chart.min.js"></script>
<script src="../../static/jiemian2/vendor/jquery-validation/jquery.validate.min.js"></script>
<script src="../../static/jiemian2/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="../../static/jiemian2/js/charts-home.js"></script>
<!-- Main File-->
<script src="../../static/jiemian2/js/front.js"></script>
</body>
<script src="/webjars/jquery/3.3.1/jquery.min.js"></script>
</html>
<script th:inline="javascript">

    /**
     * WebSocket客户端
     *
     * 使用说明：
     * 1、WebSocket客户端通过回调函数来接收服务端消息。例如：webSocket.onmessage
     * 2、WebSocket客户端通过send方法来发送消息给服务端。例如：webSocket.send();
     */
    function getWebSocket() {
        /**
         * WebSocket客户端 PS：URL开头表示WebSocket协议 中间是域名端口 结尾是服务端映射地址
         */
            // var webSocket = new WebSocket(/*[[${webSocketUrl}]]*/ 'ws://localhost:8080/chat');
        var webSocket = new WebSocket("ws://localhost:8080/websocket/"+document.getElementById('username').value);
        /**
         * 当服务端打开连接
         */
        webSocket.onopen = function (event) {
            console.log('WebSocket打开连接');
        };

        /**
         * 当服务端发来消息：1.广播消息 2.更新在线人数
         */
        webSocket.onmessage = function (event) {

            var received_msg = event.data;
            var obj = JSON.parse(received_msg);
            var touser = obj.tousername;
            var frname = obj.fromusername;
            var $messageContainer = $('.message-container');
            var judge1 = document.getElementById("username").value;
            var judge2 = document.getElementById("touser").value;
            if(frname==judge1&&touser==judge2||frname==judge2&&touser==judge1) {
                if(frname==judge1){
                    frname="我";
                }
                $messageContainer.append(
                    '<div class="mdui-card" style="margin: 3px 0;">' +

                    '<div class="mdui-card-content message-content" >' + frname + " :   " + obj.textMessage + '</div>' +
                    '</div>');

            }


        };

        /**
         * 关闭连接
         */
        webSocket.onclose = function (event) {
            console.log('WebSocket关闭连接');
        };

        /**
         * 通信失败
         */
        webSocket.onerror = function (event) {
            console.log('WebSocket发生异常');

        };
        return webSocket;
    }

    var webSocket = getWebSocket();


    /**
     * 通过WebSocket对象发送消息给服务端
     */
    function sendMsgToServer() {
        var $message = $('#msg');
        if ($message.val()) {
            webSocket.send(JSON.stringify({username: $('#username').text(), msg: $message.val()}));
            $message.val(null);
        }

    }
    function send() {
        var message = {
            "message": document.getElementById('msg').value,
            "username": document.getElementById('username').value,
            "to": document.getElementById('touser').value,
        };
        webSocket.send(JSON.stringify(message));
        $("#msg").val("");

    }

    /**
     * 清屏
     */
    function clearMsg() {
        $(".message-container").empty();
    }

    /**
     * 使用ENTER发送消息
     */
    document.onkeydown = function (event) {
        var e = event || window.event || arguments.callee.caller.arguments[0];
        e.keyCode === 13 && sendMsgToServer();
    };


</script>

