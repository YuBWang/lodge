<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <!--    页面二-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>店铺审核</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="../../static/jiemian2/vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="../../static/jiemian2/vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="../../static/jiemian2/css/fontastic.css">
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <!-- jQuery Circle-->
    <link rel="stylesheet" href="../../static/jiemian2/css/grasp_mobile_progress_circle-1.0.0.min.css">
    <!-- Custom Scrollbar-->
    <link rel="stylesheet" href="../../static/jiemian2/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="../../static/jiemian2/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="../../static/jiemian2/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="../static/img/favicon.ico">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    <!--    页面三-->
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <!--    <link href="../../static/jiemian3/assets/css/bootstrap.min.css" rel="stylesheet" />-->
    <link rel="stylesheet" href="../../static/jiemian3/css/style.css"/>
    <link href="../../static/jiemian3/assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="../../static/jiemian3/assets/css/ace.min.css" />
    <link rel="stylesheet" href="../../static/jiemian3/font/css/font-awesome.min.css" />
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="../../static/jiemian3/assets/css/ace-ie.min.css"/>
    <![endif]-->
    <script src="../../static/jiemian3/js/jquery-1.9.1.min.js"></script>
    <script src="../../static/jiemian3/assets/js/bootstrap.min.js"></script>
    <script src="../../static/jiemian3/assets/js/typeahead-bs2.min.js"></script>
    <script src="../../static/jiemian3/assets/js/jquery.dataTables.min.js"></script>
    <script src="../../static/jiemian3/assets/js/jquery.dataTables.bootstrap.js"></script>
    <script src="../../static/jiemian3/assets/layer/layer.js" type="text/javascript" ></script>
    <script src="../../static/jiemian3/assets/laydate/laydate.js" type="text/javascript"></script>
    <script src="../../static/jiemian3/js/displayPart.js" type="text/javascript"></script>
</head>

<body>
<!-- Side Navbar -->
<nav class="side-navbar">
    <div class="side-navbar-wrapper">
        <!-- Sidebar Header    -->
        <div class="sidenav-header d-flex align-items-center justify-content-center">
            <!-- User Info-->

            <!-- Small Brand information, appears on minimized sidebar-->
            <div class="sidenav-header-logo"><a href="../index.html" class="brand-small text-center"> <strong>B</strong><strong class="text-primary">D</strong></a></div>
        </div>
        <!-- Sidebar Navigation Menus-->
        <div class="main-menu">
            <h5 class="sidenav-heading">Main</h5>
            <ul id="side-main-menu" class="side-menu list-unstyled">
                <li><a href="StoreHome"> <i class="icon-home"></i>Home</a></li>
                <li><a href="#exampledropdownDropdown" aria-expanded="false" data-toggle="collapse"> <i class="icon-interface-windows"></i>店铺管理 </a>
                    <ul id="exampledropdownDropdown" class="collapse list-unstyled ">
                        <li><a href="ordmanager">订单列表</a></li>
                        <li><a href="ProdectManager">商品管理</a></li>
                        <li><a href="addEat">餐饮展示</a> </li>
                        <li><a href="toSignhtml">每日签到</a> </li>
                    </ul>
                </li>
                <li> <a th:href="@{messageList}"> <i class="icon-mail"></i>消息
                    <div class="badge badge-warning">[[${count}]] New</div></a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="page">

    <form action="upDataMessage" method="post">
        <input type="text" th:value="${list.getSigninid()}"  hidden="hidden" name="siginid" id="siginid"/>
        <input type="text" th:value="${list.getUserid()}"  hidden="hidden" name="userid" id="userid"/>
        <input type="text" th:value="${list.getOrderid()}" hidden="hidden" name="listid" id="listid"/>
        <div class="shop_reason" style="margin-top: 10px; position: absolute;top:50%;left:50%;transform: translate(-50%,-50%);" >
            <p>今日表现</p>
            <span class="content">
           <form name="form" id="form" action="/StudentPhoto" method="post" enctype="multipart/form-data" style="text-align: right">
                       <input type="file" style="color: #5bc0de;" name="fileName" id="filename" accept="image/png, image/jpeg, image/jpg" multiple="multiple" onchange="checkImage(this)">
                        <input type="button" style="color: #5bc0de;text-align: right" id="submitBtn" onclick="checkSubmit()" value="上传"/>
                    </form>

                    <div id="onLoadImage" >

                    </div>
                    <div th:if="${not#lists.isEmpty(photoList)}">
                        <div th:each="li:${photoList}">
                            <img th:src="${li}" style="height: 80px;width: 80px" />
                        </div>

                    </div>

      </span>
            <input type="text" name="message1" style="height: 120px" class="form-control" id="form_textarea" th:value="${list.getTomessage()}" onkeyup="checkLength(this);">
            </input>
            <span class="wordage">剩余字数：<span id="sy" style="color:Red;">200</span>字</span><br/>
            <input style="text-align: center;margin-left:48%;background: #5bc0de;color: white;" type="submit" id="ok" value="确定">
        </div>
    </form>


</div>
</body>
</html>
<script>
    /*字数限制*/
    function checkLength(which) {
        var maxChars = 200; //
        if(which.value.length > maxChars){
            layer.open({
                icon:2,
                title:'提示框',
                content:'您输入的字数超过限制!',
            });
            // 超过限制的字数了就将 文本框中的内容按规定的字数 截取
            which.value = which.value.substring(0,maxChars);
            return false;
        }else{
            var curr = maxChars - which.value.length; //减去当前输入的
            document.getElementById("sy").innerHTML = curr.toString();
            return true;
        }
    };
</script>
<style type="text/css">
    .form{
        position: absolute;
        top:50%;
        left:50%;
        transform: translate(-50%,-50%);
    }

</style>
<script type="text/javascript">


    var curFiles = [];//文件数组，用来保存上传的文件信息


    //检查上传的图片
    function checkImage(obj) {
        var files = obj.files;
        console.log(files.length);
        if(files){
            if(files.length<=3){
                for (var i = 0; i < files.length; i++) {
                    var item = files.item(i);
                    var size = item.size;
                    curFiles.push(item);

                }
            }else{
                alert("图片数应小于等于3");
            }


        }
        else {
            $("#filename").val("");
            alert("请选择上传文件");
        }


        onLoadImage();
    }

    //预览图片
    function onLoadImage() {
        $("#onLoadImage").html("");
        for(var i = 0; i < curFiles.length; i++){
            (function(i){
                var file = curFiles[i];
                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function(){
                    $('#onLoadImage').append("<img src='"+reader.result+"'style='height: 80px;width: 80px'/><span><span hidden>"+file.name+"</span><button id='"+i+"' onclick='del(this.id)'>×</button></span");
                }
            })(i)
        }
    }

    //删除功能
    function del(id) {
        var name = $("#"+id).prev().text();
        console.log(name);
        curFiles = curFiles.filter(function(file) {
            return file.name !== name;
        });
        console.log(curFiles);
        onLoadImage();
    }

    //上传功能的实现
    function checkSubmit() {
        var sid = document.getElementById("siginid").value;
        var uid = document.getElementById("userid").value;
        var liid = document.getElementById("listid").value;

        if(curFiles.length>0){
            var formdata =  new FormData($('#form')[0]);
            for (var i = 0; i<curFiles.length; i++) {
                formdata.append('uploadFiles', curFiles[i]);
            }
            formdata.append('sid',sid);
            formdata.append('uid',uid);
            formdata.append("listid",liid);
            console.log(formdata);
            $.ajax({
                url: '/StudentPhoto',
                type: 'post',
                data: formdata,
                processData: false,
                contentType: false,
                success: function(data) {
                    alert("上传成功");

                },
                error: function(err) {
                    alert("上传失败");
                }
            });
        }
        else{
            alert("请选择文件后上传");
        }
    }

</script>

